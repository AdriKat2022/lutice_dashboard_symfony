{% extends 'base.html.twig' %}


{% block title %}
    Vue du dashboard
{% endblock %}

{% block body %}
    <div class="container">
        <h2 class="text-center">{{ meeting.meetingName }}</h2> 
    </div>

    <div class="container">
        <h3>Détails du meeting</h3>
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">Nom</th>
                    <th scope="col">Jour du meeting</th>
                    <th scope="col">Début à</th>
                    <th scope="col">Fin à</th>
                    <th scope="col">Durée totale</th>
                </tr>
            </thead>
            <tbody>
                <td>{{ meeting.meetingName }}</td>
                <td>{{ meeting.starttime | date("F j, Y") }}</td>
                <td>{{ meeting.starttime | date("H:i") }}</td>
                <td>{{ meeting.endtime | date("H:i") }}</td>
                <td>{{ meeting.duration is empty ? "Non spécifiée" :
                "%02dh %02dm %02ds" | format(meeting.duration // 3600, (meeting.duration % 3600) // 60, meeting.duration % 60) }}</td>
        </table>
    </div>
    <div class="container-fluid mt-5 p-5">
        <h3>Participants</h3>
        <table class="table table-hover table-bordered">
            <thead class="">
                <tr>
                    <th scope="col">Utilisateur</th>
                    <th class="text-center" scope="col">Temps en ligne</th>
                    <th class="text-center" scope="col">Temps de parole</th>
                    <th class="text-center" scope="col">Temps de partage de caméra</th>
                    <th class="text-center" scope="col">Messages</th>
                    <th class="text-center" scope="col">Emojis</th>
                    <th class="text-center" scope="col">Mains levées</th>
                    <th class="text-center" scope="col">Niveau d'activité</th>
                </tr>
            </thead>
            <tbody class="table-group-divider">
                {% for cours in all_courses %}
                    <tr >
                        <td class="flex">
                            <div class="inline-block">
                                {{ "#{cours.eleve.firstName} #{cours.eleve.lastname}" }}
                                <p class="text-xs text-muted mb-0 mt-2"><i class="bi bi-arrow-right-square me-2"></i>{{ cours.starttime | date("H:i") }}</p>
                                <p class="text-xs text-muted mb-0"><i class="bi bi-arrow-left-square me-2"></i>{{ cours.endtime | date("H:i") }}</p>
                            </div>
                        </td>
                        <td class="flex align-middle">
                            <div class="inline-block text-center">
                                {% if cours.onlineTime is empty %}
                                    Non spécifié
                                {% else %}
                                    {% set seconds_full = cours.onlineTime / 1000 %}
                                    {% set hours = seconds_full // 3600 %}
                                    {% set minutes = (seconds_full % 3600) // 60 %}
                                    {% set seconds = (seconds_full % 60) %}

                                    {% if hours == 0 and minutes == 0 %}
                                        Moins d'une minute
                                    {% elseif hours == 0 %}
                                        {{ minutes }} minute(s)
                                    {% else %}
                                        {{ "%02dh %02dm %02ds"|format(hours, minutes, seconds) }}
                                    {% endif %}
                                    <div class="progress">
                                        {% set step = 1 %}
                                        {% set percentage = (((100/step) * seconds_full / meeting.duration) | round(0, 'common')) * step %}
                                        <div class="progress-bar" role="progressbar" style="width: {{ percentage }}%">{{ percentage }} %</div>
                                    </div>
                                {% endif %}
                        </td>
                        <td class="flex text-center align-middle">
                            {% if cours.talkTime is empty %}
                                Non spécifié
                            {% elseif cours.talkTime == 0 %}
                                {# <p class="mb-0">Pas de parole</p>
                                <i class="bi bi-mic-mute-fill"></i> #}
                                {# <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-mic-mute-fill" viewBox="0 0 16 16">
                                    <path d="M13 8c0 .564-.094 1.107-.266 1.613l-.814-.814A4 4 0 0 0 12 8V7a.5.5 0 0 1 1 0zm-5 4c.818 0 1.578-.245 2.212-.667l.718.719a5 5 0 0 1-2.43.923V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 1 0v1a4 4 0 0 0 4 4m3-9v4.879L5.158 2.037A3.001 3.001 0 0 1 11 3"/>
                                    <path d="M9.486 10.607 5 6.12V8a3 3 0 0 0 4.486 2.607m-7.84-9.253 12 12 .708-.708-12-12z"/>
                                </svg> #}
                            {% else %}
                                {% set seconds_full = cours.talkTime / 1000 %}
                                {% set hours = seconds_full // 3600 %}
                                {% set minutes = (seconds_full % 3600) // 60 %}
                                {% set seconds = (seconds_full % 60) %}

                                {% if hours == 0 and minutes == 0 %}
                                    &lt; 1 minute
                                {% elseif hours == 0 %}
                                    {{ minutes }} minute(s)
                                {% else %}
                                    {{ "%02dh %02dm %02ds"|format(hours, minutes, seconds) }}
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="flex text-center align-middle">
                            {% if cours.webcamTime is empty %}
                                Non spécifié
                            {% elseif cours.webcamTime == 0 %}
                                {# <p class="mb-0">Pas de caméra</p>
                                <i class="bi bi-camera-video-off-fill"></i> #}
                                {# <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-camera-video-off-fill" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M10.961 12.365a2 2 0 0 0 .522-1.103l3.11 1.382A1 1 0 0 0 16 11.731V4.269a1 1 0 0 0-1.406-.913l-3.111 1.382A2 2 0 0 0 9.5 3H4.272zm-10.114-9A2 2 0 0 0 0 5v6a2 2 0 0 0 2 2h5.728zm9.746 11.925-10-14 .814-.58 10 14z"/>
                                </svg> #}
                            {% else %}
                                {% set seconds_full = cours.webcamTime / 1000 %}
                                {% set hours = seconds_full // 3600 %}
                                {% set minutes = (seconds_full % 3600) // 60 %}
                                {% set seconds = (seconds_full % 60) %}

                                {% if hours == 0 and minutes == 0 %}
                                    &lt; 1 minute
                                {% elseif hours == 0 %}
                                    {{ minutes }} minute(s)
                                {% else %}
                                    {{ "%02dh %02dm %02ds"|format(hours, minutes, seconds) }}
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="flex text-center align-middle">
                            {# Si le nombre de message est null ou = 0, alors on affiche une icone #}
                            {% if cours.messageCount is empty or cours.messageCount == 0 %}
                                {# <p class="mb-0">Pas de message</p> #}
                                {# <i class="bi bi-chat-right-dots-fill"></i> #}
                                {# <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-chat-right-dots-fill" viewBox="0 0 16 16">
                                    <path d="M16 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h9.586a1 1 0 0 1 .707.293l2.853 2.853a.5.5 0 0 0 .854-.353zM5 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 1a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
                                </svg> #}
                            {% else %}
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-right-dots-fill me-1" viewBox="0 0 16 16">
                                    <path d="M16 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h9.586a1 1 0 0 1 .707.293l2.853 2.853a.5.5 0 0 0 .854-.353zM5 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 1a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
                                </svg>
                                x {{ cours.messageCount }}
                            {% endif %}
                        </td>
                        <td class="flex text-center align-middle">
                            {# Si le nombre d'emoji est null ou = 0, alors on affiche une icone #}
                            {% if cours.emojis is empty or (cours.emojis | length) < 1 or (((cours.emojis | length) == 1) and cours.emojis.raiseHand is defined) %}
                                {# <p class="mb-0">Pas de réaction</p>
                                <i class="bi bi-emoji-frown-fill"></i> #}
                                {# <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-emoji-frown-fill" viewBox="0 0 16 16">
                                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5m-2.715 5.933a.5.5 0 0 1-.183-.683A4.5 4.5 0 0 1 8 9.5a4.5 4.5 0 0 1 3.898 2.25.5.5 0 0 1-.866.5A3.5 3.5 0 0 0 8 10.5a3.5 3.5 0 0 0-3.032 1.75.5.5 0 0 1-.683.183M10 8c-.552 0-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5S10.552 8 10 8"/>
                                </svg> #}
                            {% else %}
                                {% for name, emoji in cours.emojis %}
                                    {% if name != "raiseHand" %}
                                        <p class="mb-0">
                                            <i class="{{ emojis_visual_map[name] }} me-1"></i>
                                            x {{ emoji.count }}
                                        </p>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </td>
                        <td class="flex text-center align-middle">
                            {# Si il n'y a pas d'émoji ou que raiseHand n'est pas défini, alors on affiche une icone #}
                            {% if cours.emojis is empty or not cours.emojis.raiseHand is defined %}
                                {# <p class="mb-0">Pas de main levée</p>
                                <i class="bi bi-emoji-frown-fill"></i> #}
                                {# <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-person-raised-hand" viewBox="0 0 16 16">
                                    <path d="M6 6.207v9.043a.75.75 0 0 0 1.5 0V10.5a.5.5 0 0 1 1 0v4.75a.75.75 0 0 0 1.5 0v-8.5a.25.25 0 1 1 .5 0v2.5a.75.75 0 0 0 1.5 0V6.5a3 3 0 0 0-3-3H6.236a1 1 0 0 1-.447-.106l-.33-.165A.83.83 0 0 1 5 2.488V.75a.75.75 0 0 0-1.5 0v2.083c0 .715.404 1.37 1.044 1.689L5.5 5c.32.32.5.754.5 1.207"/>
                                    <path d="M8 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"/>
                                </svg> #}
                            {% else %}
                                <p class="mb-0">
                                    <i class="{{ emojis_visual_map.raiseHand }} me-1"></i>
                                    x {{ cours.emojis.raiseHand.count }}
                                </p>
                            {% endif %}
                        </td>
                        <td class="flex text-center align-middle">
                            {# Si le niveau d'activité n'est pas renseigné, on affiche une icone #}
                            {% if cours.activityLevel is empty %}
                                <p class="mb-0">Non calculé</p>
                                <i class="bi bi-slash-circle-fill"></i>
                            {% else %}
                                <div class="d-inline-flex align-items-center">
                                    {# On affiche le niveau d'activité avec des icones #}
                                    {% for i in 1..10 %}
                                        {% if cours.activityLevel >= (i-0.45) %}
                                            <i class="bi bi-circle-fill me-1"></i>
                                        {% else %}
                                            <i class="bi bi-circle me-1"></i>
                                        {% endif %}
                                    {% endfor %}
                                    <span class="badge rounded-full text-bg-secondary ms-1">{{ cours.activityLevel | round(1) }}</span>
                                </div>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
{% endblock %}